<!doctype html>
<html lang="en">
<head>
  <title>2u.fm</title>

  <!-- Meta -->
  <meta charset="utf-8">
  <%= csrf_meta_tag %>
  <meta name="author" content="Nate Wienert">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <!-- TODO: remove -->
  <meta name="robots" content="noindex">

  <!-- HTML5 shim, for IE6-8 support of HTML elements -->
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <%= stylesheet_link_tag "application", :debug => Rails.env.development? %>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,600' rel='stylesheet' type='text/css'>

  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-32843361-1']);
    _gaq.push(['_trackPageview']);
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>

  <script type="text/javascript">
    var updateBroadcastsIds, updateFollowsIds, updateListensIds, updateBroadcastsCounts,
        broadcastedIds = [];

    <%- if user_signed_in? -%>
      beginListen = <%= raw current_user.listens.last.as_json.to_json %>;
    <%- else -%>
      beginListen = false;
    <%- end -%>
  </script>
</head>

<body class="<%= user_body_classes %>" data-media="<%= Yetting.s3_url %>"<% if user_signed_in? %> data-user="<%= current_user.id %>" <% if current_user.can_download? %> data-role="admin"<% end %><% end %>>

  <div id="body-wrap">
    <header>
      <h1><%= link_to '2u.fm', '/', :title => '2u.fm, find and share music' %> </h1>

      <div id="bar">
        <div id="player">
          <div id="player-controls" class="player-buttons">
            <%= link_to '<span>4</span>'.html_safe, '#', :class => 'play pictos control', :id => 'player-play', :title => 'Play/pause' %>
            <%= link_to '<span>7</span>'.html_safe, '#', :class => 'next pictos control', :id => 'player-next', :title => 'Next song' %>
          </div>

          <div id="player-buttons">
            <span class="broadcast">
              <%= render partial: "songs/broadcast", locals: { action: 'add', id: '0', count: 'Like', extra_class: 'disabled'  } %>
              <%= render partial: "songs/broadcast", locals: { action: 'destroy', id: '0', count: 'Unlike'  } %>
            </span>
            <%= link_to 'Share', '#share', :id => 'player-share', :class => 'nav-hover control pictos-link disabled update-clipboard', 'data-pad' => '8'  %>
            <%= link_to 'Playlist', '#player-playlist', :class => 'nav-hover control pictos-list disabled', :id => 'nav-music', 'data-pad' => '8' %>
            <%= link_to 'Off', '#friends', id: 'tune-in', class: 'nav-hover hover-off control pictos-globe tip-e', 'data-pad' => '18', title: 'Turn on live listening' %>
          </div>

          <div id="player-main">

            <div id="player-meta">
              <span id="player-song-name"><a title="Return to song" class="tip-n" href="">&nbsp;</a></span>
              <span id="player-artist-name">&nbsp;</span>
            </div>

            <div id="player-bottom">
              <div id="player-mini-controls">
                <%= link_to 'Sound', '#', :class => 'volume control pictos-volume-on tip', :id => 'player-volume', title: 'Volume' %>
                <%= link_to 'Normal', "", :id => 'player-mode', :class => 'control pictos-normal post tip', title: 'Play in order' %>
              </div>
              <div id="player-progress-bar">
                <div id="player-progress-grabber"></div>
                <div id="player-progress-inner-wrap">
                  <div id="player-progress-position"></div>
                  <div id="player-progress-loaded"></div>
                </div>
              </div>
              <div id="player-timer">0:00</div>
            </div>
            <!-- /player bottom -->
          </div>
          <!-- /player-meta -->
        </div>
        <!-- /player-main -->
      </div>
      <!-- /player -->
    </header>

    <div id="player-live">
      <%= link_to '0 people listening to you', '', 'data-count' => '0' %>
    </div>

    <div id="main-mid">
      <%= form_tag '/main/search', :method => 'get', :id => "search-form" do %>
        <%= text_field_tag :query, '', :placeholder =>"Click to search" %>
        <%= submit_tag :s, :id => 'search', :class => 'pictos tip-n', :title => 'Search!' %>
      <% end -%>

      <div id="navbar">
        <div id="navbar-menus">
          <%- if user_signed_in? -%>
          <section class="nav-user">
            <h1><%= current_user.username %></h1>
            <%= link_to ("Profile " + image_tag(current_user.avatar.url(:small))).html_safe, '/' + current_user.station_slug, :id => 'nav-user' %>
            <%= link_to 'Feed', feed_user_path(current_user), :id => 'nav-feed', :class => 'pictos-list' %>
            <%= link_to 'Inbox', '/shares/inbox', :id => 'nav-shares', :class => 'pictos-inbox', 'data-shares' => current_user.received_songs_notifications %>
          </section>
          <%- end -%>

          <section>
            <h1>Songs</h1>
            <%= link_to 'Just in', '/fresh', :id => 'nav-new', :class => 'pictos-time' %>
            <%= link_to 'Trending', '/', :id => 'nav-trending', :class => 'pictos-pulse'  %>
            <%= link_to 'Popular', '/popular', :id => 'nav-popular', :class => 'pictos-star' %>
          </section>

          <section>
            <h1>Browse</h1>
            <%= link_to 'Genres', '/genres', :id => 'nav-genres', :class => 'pictos-music' %>
            <%= link_to 'Artists', '/artists', :id => 'nav-artists', :class => 'pictos-users' %>
            <%= link_to 'Blogs', '/blogs', :id => 'nav-blogs', :class => 'pictos-newspaper' %>
          </section>

          <section class="nav-extra account">
            <% if user_signed_in? %>
              <%= link_to "Find friends", '/find_friends', id: 'nav-friends' %>
              <%= link_to "Account", '/account' %>
              <%= link_to 'Log out', destroy_user_session_path, :method => 'delete', :class=> 'control' %>
            <% else %>
              <%= link_to 'Login', '#modal-login', :class => 'modal' %>
            <% end %>
            <% link_to "About Us", "#", :class => "secondary" %>
          </section>

          <section class="stations">
            <h1 class="collapse">Friends</h1>
            <div id="stations-inner">
            </div>
          </section>
        </div>
      </div>

      <div id="body">
        <%= render :template => 'layouts/single' %>
      </div>
    </div>
  </div>

  <div id="welcome">
    <small>What is 2u.fm?</small>
    <section>
      <h1>All the best new music from across the web.</h1>
      <h1>The easiest way to find and share music with your friends.</h1>
      <h1>A place to discover and follow new artists and songs.</h1>
      <h1>Music + social, without cluttering up your other profiles.</h1>
    </section>
    <%= link_to 'Learn More', '/tour', :class => 'button add' %>
    <%= link_to 'D', '', :class => 'control pictos', :id => 'close-welcome' %>
  </div>


  <!-- Hover menus -->

  <div id="player-playlist" class="pop-menu right-align"></div>
  <div id="player-playlist-template" class="hidden">
    <h4>{{station.title}}</h4>
    {{#songs}}
      <a class="control song-{{id}}" href="#song-{{id}}" data-index="{{index}}">
        <span class="artist">{{artist_name}}</span> - <span class="name">{{name}}</span>
      </a>
    {{/songs}}
  </div>

  <div id="share" class="pop-menu">
    <%= link_to image_tag('/images/facebook.png'), '', :class => 'player-invite control popup', 'data-dimensions' => '800,400', 'data-link' => 'http://facebook.com/sharer.php?u={{url}}&t={{text}}' %>
    <%= link_to image_tag('/images/twitter.png'), '', :class => 'player-invite control popup', 'data-dimensions' => '600,300', 'data-link' => 'https://twitter.com/share?url={{url}}&text={{text}}' %>
    <span id="share-link-container"><%= link_to "j", '', :id => 'share-link', :class => 'control pictos tip', :title => "Copy link to clipboard", 'data-click' => '3' %></span>
    <div id="share-friends"></div>
  </div>

  <div id="buy" class="pop-menu">
    <%= link_to 'iTunes', 'http://itunes.com', :class => 'control popup', 'data-dimensions' => '800,400', 'data-link' => '' %>
    <%= link_to 'Amazon', 'http://amazon.com', :class => 'control popup', 'data-dimensions' => '800,400', 'data-link' => '' %>
    <%= link_to 'Beatport', 'http://beatport.com', :class => 'control popup', 'data-dimensions' => '800,400', 'data-link' => '' %>
    <%= link_to 'eMusic', 'http://emusic.com', :class => 'control popup', 'data-dimensions' => '800,400', 'data-link' => '' %>
  </div>

  <div id="friends" class="pop-menu right-align"></div>


  <!-- Modals -->

  <div id="overlay" class="shown slow-fade"></div>
  <div id="modal"></div>

  <div class="hidden">
    <% if !user_signed_in? %>
      <%= render 'modals/login' %>
    <% else %>

      <% if current_user.full_name.blank? %>

        <div id="modal-new-user" class="center">
          <h3>Please enter your name</h3>
          <%= form_for current_user, :url => { :action => :edit }, :html => { :multipart => true } do |f| %>
            <div class="clearfix">
              <%= label :user, :full_name, 'Full Name', :class => 'inline' %>
              <%= f.text_field :full_name %>
            </div>
            <div class="modal-actions">
              <%= submit_tag 'Update', :class => 'submitbutton inline' %>
              <em>or</em>
              <%= link_to "Link with Facebook", user_omniauth_authorize_path(:facebook), :class => 'facebook-button login-button popup button control', 'data-dimensions' => '800,500' %>
            </div>
          <% end %>
        </div>

      <% elsif current_user.first_time? %>
        <%= render 'modals/new_user' %>
      <% end %>
    <% end %>

    <div id="friends-template">
      <div class="online">
      {{#online}}
        <%= render partial: 'users/friend_link' %>
      {{/online}}
      </div>
      {{#offline}}
        <%= render partial: 'users/friend_link' %>
      {{/offline}}
    </div>
  </div>

  <!-- Others -->
  <div id="song-dragger" class="pictos">m</div>
  <div id="spinner" class="hidden"></div>
  <div id="null"></div>
  <div id="tunein"></div>

  <%= javascript_include_tag "application", :debug => Rails.env.development? %>
  <%= subscribe_to "/users/#{current_user.id}" if user_signed_in? %>
</body>
</html>