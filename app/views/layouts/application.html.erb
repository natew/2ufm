<!doctype html>
<html lang="en">
<head>
  <title>2u.fm</title>

  <!-- Meta -->
  <meta charset="utf-8">
  <%= csrf_meta_tag %>
  <meta name="author" content="Nate Wienert">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <!-- TODO: remove -->
  <meta name="robots" content="noindex">

  <!-- HTML5 shim, for IE6-8 support of HTML elements -->
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <%= stylesheet_link_tag "application", :debug => Rails.env.development? %>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,600' rel='stylesheet' type='text/css'>

  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-32843361-1']);
    _gaq.push(['_trackPageview']);
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
</head>

<body class="<%= user_signed_in? ? 'signed_in' : 'signed_out' %>" data-media="<%= Yetting.s3_url %>">

  <header>
    <div class="page-contain">
      <h1><%= link_to '2u.fm', '/', :title => '2u.fm, find and share music' %> </h1>

      <div id="bar">
        <div id="player">
          <div id="player-controls" class="player-buttons">
            <%= link_to '<span>4</span>'.html_safe, '#', :class => 'play pictos control', :id => 'player-play', :title => 'Play/pause' %>
            <%= link_to '<span>7</span>'.html_safe, '#', :class => 'next pictos control', :id => 'player-next', :title => 'Next song' %>
          </div>

          <div id="player-main">

            <div id="player-meta">
              <span id="player-song-name"><a href="">&nbsp;</a></span>
              <span id="player-artist-name">&nbsp;</span>
            </div>

            <div id="player-bottom">
              <div id="player-pre-controls">
                <%= link_to 'm', '#player-playlist', :class => 'pictos nav control tip-n', :id => 'nav-music', :title => 'Current Playlist' %>
              </div>
              <div id="player-progress-bar">
                <div id="player-progress-grabber"></div>
                <div id="player-progress-inner-wrap">
                  <div id="player-progress-position"></div>
                  <div id="player-progress-loaded"></div>
                </div>
              </div>
              <div id="player-timer">0:00</div>
              <div id="player-post-controls">
                <%= link_to '>', '#', :class => 'volume pictos control tip-n', :id => 'player-volume', :title => 'Volume toggle' %>
              </div>
            </div>
            <!-- /player bottom -->
          </div>
          <!-- /player-meta -->

          <%= form_tag '/main/search', :method => 'get', :id => "search-form" do %>
            <%= text_field_tag :query, '', :placeholder =>"Search for anything!" %>
            <%= submit_tag :s, :id => 'search', :class => 'pictos tip-n', :title => 'Search!' %>
          <% end -%>
        </div>
        <!-- /player-main -->
      </div>
      <!-- /player -->
    </div>
  </header>

  <div id="main-mid">
    <div class="page-contain">
      <div id="navbar">

        <div id="navbar-menus">
          <%- if user_signed_in? -%>
          <section class="nav-user">
            <%= link_to current_user.username, current_user, :id => 'nav-user' %>
            <%= link_to 'Feed', '/feed', :id => 'nav-feed' %>
            <%= link_to 'Stations', '/stations', :id => 'nav-stations' %>
          </section>
          <%- end -%>

          <section class="nav-extra">
            <%= link_to 'Songs', '/', :id => 'nav-home' %>
            <%= link_to 'Artists', '/artists', :id => 'nav-artists' %>
            <%= link_to 'Blogs', '/blogs', :id => 'nav-blogs' %>
            <% link_to 'Users', '/users', :id => 'nav-users' %>
          </section>

          <section class="nav-extra account">
            <% if user_signed_in? %>
              <%= link_to "Account", '/account' %>
              <%= link_to 'Log out', destroy_user_session_path, :method => 'delete', :class=> 'control' %>
            <% else %>
              <%= link_to 'Login', '/login', :class => 'restricted'  %>
              <%= link_to 'Sign up', '/signup', :class => 'restricted' %>
            <% end %>
            <% link_to "About Us", "#", :class => "secondary" %>
          </section>

          <% if @friends and @friends.length > 0 %>
          <section class="nav-extra stations">
            <h1 class="collapse">Following</h1>
            <%= render :partial => 'users/friend', :collection => @friends %>
          </section>
          <% end %>
        </div>
      </div>

      <div id="body">
        <%= render :template => 'layouts/single' %>
      </div>
    </div>
  </div>

  <div id="welcome">
    <small>What is 2u.fm?</small>
    <section>
      <h1>The best new music from across the web.</h1>
      <h1>An easy way to listen to music with friends.</h1>
      <h1>A place to discover and follow new artists.</h1>
      <h1>.</h1>
    </section>
    <%= link_to 'Learn More', '/tour', :class => 'button add' %>
    <%= link_to 'D', '', :class => 'control pictos', :id => 'close-welcome' %>
  </div>

  <a id="debug" class="control" href="">x</a>
  <div id="debug_dump"></div>

  <!-- Menu items -->
  <div id="nav-user" class="pop-menu">
    <% if user_signed_in? %>
      <span id="current_user" data-id="<%= current_user.id %>"></span>

    <% else %>
      <%= link_to 'Login / Signup', '#new-user', :class => 'modal pictos-key' %>
    <% end %>
  </div>

  <div id="player-playlist" class="pop-menu">
    <h4>{{station.title}}</h4>
    {{#songs}}
      <a class="control song-{{id}}" href="#song-{{id}}" data-index="{{index}}">
        <span class="artist">{{artist_name}}</span> - <span class="name">{{name}}</span>
      </a>
    {{/songs}}
  </div>

  <!-- Modals -->
  <div id="overlay" class="shown slow-fade"></div>
  <div id="modal"></div>

  <% if !user_signed_in? %>
    <div id="modal-login">
      <h3>Welcome</h3>
      <p>Login with facebook to begin browsing music</p>
      <%= link_to "Sign in with Facebook", user_omniauth_authorize_path(:facebook), :class => 'facebook-button control popup', 'data-dimensions' => '750,450' %>
    </div>
  <% end %>

  <div class="hidden">
    <div id="modal-user">
      <h3>Welcome to 2u.fm  <small>sign up in seconds!</small></h3>
      <div id="user-signup">
        <%= render :partial => 'registrations/new_form' %>
      </div>
      <div id="user-login">
        <h4>Sign in</h4>
        <%= render :partial => 'sessions/new_form' %>
      </div>
    </div>

    <div id="help">
      <h3>Help</h3>
      <p>Welcome to 2u.fm!  We are collectors of the latest and greatest music from all around the web.  We find new music and sort it all out so you can sit back and enjoy.  Check out our <strong><%= link_to 'popular', '/popular' %></strong>, <strong><%= link_to 'genre', '/genres' %></strong>, and <strong><%= link_to 'artist', '/artists' %></strong> stations to get a start.
      </p>

      <h4>Keyboard Shortcuts</h4>
      <dl>
        <dt>Space</dt><dd>Pause / Play</dd>
        <dt>Enter</dt><dd>Play highlighted song</dd>
        <dt>Arrow keys</dt><dd>Next / Prev</dd>
      </dl>
    </div>
  </div>

  <!-- Spinner -->
  <div id="spinner" class="hidden"></div>

  <%= javascript_include_tag "application", :debug => Rails.env.development? %>

</body>
</html>