<!doctype html>
<html lang="en">
<head>
  <title>2u.fm</title>

  <!-- Meta -->
  <meta charset="utf-8">
  <%= csrf_meta_tag %>
  <meta name="author" content="Nate Wienert">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <!-- TODO: remove -->
  <meta name="robots" content="noindex">

  <!-- HTML5 shim, for IE6-8 support of HTML elements -->
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <%= stylesheet_link_tag "application", :debug => Rails.env.development? %>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,600' rel='stylesheet' type='text/css'>

  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-32843361-1']);
    _gaq.push(['_trackPageview']);
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>

  <script type="text/javascript">
    var updateBroadcastsIds, updateFollowsIds, updateListensIds, updateBroadcastsCounts;
  </script>
</head>

<body class="<%= user_signed_in? ? 'signed_in' : 'signed_out' %>" data-media="<%= Yetting.s3_url %>"<% if user_signed_in? %> data-user="<%= current_user.id %>"<% end %>>

  <div id="body-wrap">
    <header>
      <h1><%= link_to '2u.fm', '/', :title => '2u.fm, find and share music' %> </h1>

      <div id="bar">
        <div id="player">
          <div id="player-controls" class="player-buttons">
            <%= link_to '<span>4</span>'.html_safe, '#', :class => 'play pictos control', :id => 'player-play', :title => 'Play/pause' %>
            <%= link_to '<span>7</span>'.html_safe, '#', :class => 'next pictos control', :id => 'player-next', :title => 'Next song' %>
          </div>

          <div id="player-buttons">
            <%= link_to 'Share', '#share', :id => 'player-share', :class => 'nav-hover control pictos-link disabled update-clipboard' %>
            <%= link_to 'Playlist', '#player-playlist', :class => 'nav control pictos-music disabled', :id => 'nav-music' %>
            <%= link_to 'Sound', '#', :class => 'volume control pictos-volume-on', :id => 'player-volume' %>
            <%= link_to 'Off', "", :id => 'player-mode', :class => 'control pictos-repeat' %>
          </div>

          <div id="player-main">

            <div id="player-meta">
              <span id="player-song-name"><a title="Return to song" class="tip-n" href="">&nbsp;</a></span>
              <span id="player-artist-name">&nbsp;</span>
            </div>

            <div id="player-bottom">
              <div id="player-progress-bar">
                <div id="player-progress-grabber"></div>
                <div id="player-progress-inner-wrap">
                  <div id="player-progress-position"></div>
                  <div id="player-progress-loaded"></div>
                </div>
              </div>
              <div id="player-timer">0:00</div>
            </div>
            <!-- /player bottom -->
          </div>
          <!-- /player-meta -->
        </div>
        <!-- /player-main -->
      </div>
      <!-- /player -->
    </header>

    <div id="main-mid">
      <div id="navbar">
        <div id="navbar-menus" class="scroll-pane">
          <%= form_tag '/main/search', :method => 'get', :id => "search-form" do %>
            <%= text_field_tag :query, '', :placeholder =>"Click to search" %>
            <%= submit_tag :s, :id => 'search', :class => 'pictos tip-n', :title => 'Search!' %>
          <% end -%>

          <%- if user_signed_in? -%>
          <section class="nav-user">
            <h1><%=  %></h1>
            <%= link_to (current_user.username + " " + image_tag(current_user.avatar.url(:small))).html_safe, current_user, :id => 'nav-user' %>
            <%= link_to 'Feed', '/feed', :id => 'nav-feed', :class => 'pictos-list' %>
            <%= link_to 'Following', '/users/following', :id => 'nav-following', :class => 'pictos-add' %>
            <%= link_to 'Inbox', '/shares/inbox', :id => 'nav-shares', :class => 'pictos-inbox' %>
          </section>
          <%- end -%>

          <section>
            <%= link_to 'Just in', '/fresh', :id => 'nav-new', :class => 'pictos-time' %>
            <%= link_to 'Trending', '/', :id => 'nav-trending', :class => 'pictos-globe'  %>
            <%= link_to 'Popular', '/popular', :id => 'nav-popular', :class => 'pictos-star' %>
            <%= link_to 'Artists', '/artists', :id => 'nav-artists', :class => 'pictos-users' %>
            <% link_to 'Blogs', '/blogs', :id => 'nav-blogs', :class => 'pictos-newspaper' %>
          </section>

          <section class="nav-extra account">
            <% if user_signed_in? %>
              <%= link_to "Find friends", '/users', :id => 'nav-friends' %>
              <%= link_to "Account", '/account' %>
              <%= link_to 'Log out', destroy_user_session_path, :method => 'delete', :class=> 'control' %>
            <% else %>
              <%= link_to 'Login', '#modal-login', :class => 'modal' %>
            <% end %>
            <% link_to "About Us", "#", :class => "secondary" %>
          </section>

          <section class="stations">
            <h1 class="collapse">Friends</h1>
            <div id="stations-inner">
            </div>
          </section>
        </div>
      </div>

      <div id="body">
        <%= render :template => 'layouts/single' %>
      </div>
    </div>
  </div>

  <div id="welcome">
    <small>What is 2u.fm?</small>
    <section>
      <h1>All the best new music from across the web.</h1>
      <h1>The easiest way to find and share music with your friends.</h1>
      <h1>A place to discover and follow new artists and songs.</h1>
      <h1>Music + social, without cluttering up your other profiles.</h1>
    </section>
    <%= link_to 'Learn More', '/tour', :class => 'button add' %>
    <%= link_to 'D', '', :class => 'control pictos', :id => 'close-welcome' %>
  </div>

  <div id="player-playlist" class="pop-menu"></div>
  <div id="player-playlist-template" class="hidden">
    <h4>{{station.title}}</h4>
    {{#songs}}
      <a class="control song-{{id}}" href="#song-{{id}}" data-index="{{index}}">
        <span class="artist">{{artist_name}}</span> - <span class="name">{{name}}</span>
      </a>
    {{/songs}}
  </div>

  <div id="share" class="pop-menu">
    <%= link_to image_tag('/images/facebook.png'), '', :class => 'player-invite control popup', 'data-dimensions' => '800,400', 'data-link' => 'http://facebook.com/sharer.php?u={{url}}&t={{text}}' %>
    <%= link_to image_tag('/images/twitter.png'), '', :class => 'player-invite control popup', 'data-dimensions' => '600,300', 'data-link' => 'https://twitter.com/share?url={{url}}&text={{text}}' %>
    <span id="share-link-container"><%= link_to "j", '', :id => 'share-link', :class => 'control pictos tip', :title => "Copy link to clipboard", 'data-click' => '3' %></span>
    <div id="share-friends"></div>
  </div>

  <!-- Modals -->
  <div id="overlay" class="shown slow-fade"></div>
  <div id="modal"></div>

  <% if !user_signed_in? %>
    <div id="modal-login" class="hidden permanent">
      <h3>Welcome to 2u.fm!</h3>
      <p class="large"></p>

      <form id="modal-login-form" class="centered">
        <label for="login-email">What's your email address?</label>
        <input type="text" name="login-email" id="login-email" placeholder="user@example.com" />
      </form>

      <%= link_to "Sign in with Facebook", user_omniauth_authorize_path(:facebook), :class => 'facebook-button login-button popup control', 'data-dimensions' => '800,500' %>
      <%= link_to "Sign in with Twitter", user_omniauth_authorize_path(:twitter), :class => 'twitter-button login-button popup control', 'data-dimensions' => '800,500' %>

      <em>or <%= link_to 'login without a social network', '#loner-login', :class => 'show-hide' %></em>

      <div class="hidden" id="loner-login">
        <div class="half inline">
          <h4>Sign up</h4>
          <%= render :partial => 'registrations/new_form' %>
        </div>

        <div class="half inline">
          <h4>Login</h4>
          <%= render :partial => 'sessions/new_form' %>
        </div>
      </div>

      <%= link_to 'x', '', :class => 'close-modal control' %>
    </div>
  <% end %>

  <div id="song-dragger" class="pictos">m</div>

  <div class="hidden">
    <div id="help">
      <h3>Help</h3>
      <p>Welcome to 2u.fm!  We are collectors of the latest and greatest music from all around the web.  We find new music and sort it all out so you can sit back and enjoy.  Check out our <strong><%= link_to 'popular', '/popular' %></strong>, <strong><%= link_to 'genre', '/genres' %></strong>, and <strong><%= link_to 'artist', '/artists' %></strong> stations to get a start.
      </p>

      <h4>Keyboard Shortcuts</h4>
      <dl>
        <dt>Space</dt><dd>Pause / Play</dd>
        <dt>Enter</dt><dd>Play highlighted song</dd>
        <dt>Arrow keys</dt><dd>Next / Prev</dd>
      </dl>
    </div>

    <div id="friends">
      <div class="online">
      {{#online}}
        <%= render :partial => 'users/friend_link' %>
      {{/online}}
      </div>
      {{#offline}}
        <%= render :partial => 'users/friend_link' %>
      {{/offline}}
    </div>
  </div>

  <!-- Spinner -->
  <div id="spinner" class="hidden"></div>
  <div id="null"></div>

  <%= javascript_include_tag "application", :debug => Rails.env.development? %>

</body>
</html>